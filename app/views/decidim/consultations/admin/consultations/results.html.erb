<div class="card" id="consultations">
  <div class="card-divider">
    <h2 class="card-title">
      <%= t "decidim.admin.titles.results" %>
      <span class="label button--title">
        <%= t "decidim.admin.consultations.results.total_votes", count: current_consultation.total_votes %>
        /
        <%= t "decidim.admin.consultations.results.participants", count: current_consultation.total_participants %>
      </span>
      <span id="export-consultation-results" class="button--title">
        <% if current_consultation.results_published? %>
          <%= link_to t("decidim.admin.consultations.results.export"), decidim_admin_action_delegator.consultation_exports_path(current_consultation), method: :post, class: "button tiny button--title" %>
        <% else %>
          <span class="button tiny button--title disabled"><%= t("decidim.admin.consultations.results.export") %></span>
        <% end %>
      </span>
    </h2>
  </div>
  <div class="card-section">
    <table class="table-list">
      <% current_consultation.questions.published.includes(:responses).each do |question| %>
        <% unless question.external_voting %>
          <thead>
            <tr>
              <th><%= strip_tags translated_attribute question.title %></th>
              <th><%= I18n.t("decidim.admin.consultations.results.membership_type") %></th>
              <th><%= I18n.t("decidim.admin.consultations.results.membership_weight") %></th>
              <th class="table-list__actions">
                <%= t "decidim.admin.consultations.results.total_votes", count: question.total_votes %>
                /
                <%= t "decidim.admin.consultations.results.participants", count: question.total_participants %>
              </th>
            </tr>
          </thead>
          <tbody>
            <% if question.publishable_results? %>
              <% Decidim::ActionDelegator::ResponsesByMembership.new(question).query.each do |group| %>
              <tr>
                <td class="response-title"><%= strip_tags translated_attribute group.title %></td>
                <td class="membership-type"><%= group.membership_type %></td>
                <td class="membership-weight"><%= group.membership_weight %></td>
                <td class="votes-count"><%= group.votes_count %></td>
              </tr>
              <% end %>
            <% else %>
              <tr>
                <td><em><%= t "decidim.admin.consultations.results.not_visible" %></em></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
              </tr>
            <% end %>
          </tbody>
        <% end %>
      <% end %>
    </table>
  </div>
</div>
